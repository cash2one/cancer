<!DOCTYPE html>
{% extends "base.html" %}

{% load staticfiles %}

{%block script%}
    <script src="{% static "js/jquery.dataTables.js" %}"></script>
    <link rel="stylesheet" href="{% static "css/jquery.dataTables.css" %}" />
    
    <style>
        div.dataTables_filter {
            text-align: left;
        }
        .col-sm-6 {
            width: 20%;
        }
      .filterMatches { background-color: #FFFF00; }



    </style>

    <script>
    $.extend( $.fn.dataTable.defaults, {
        "searching": true,
        "ordering": true
    } );

    $(document).ready(function() {

        //hide empty columns
        $('#recent tr th').each(function(i) {
         //select all tds in this column
         var tds = $(this).parents('table')
                  .find('tr td:nth-child(' + (i + 1) + ')');
            //check if all the cells in this column are empty
            if(tds.length == tds.filter(':empty').length) { 
                //hide header
                $(this).hide();
                //hide cells
                tds.hide();
            } 
        }); 

        var table = $('#recent').dataTable( {
            //highlight search text, CHECK
            "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                var settings = this.fnSettings();
                var str = settings.oPreviousSearch.sSearch;
                var regex = new RegExp( str, 'i');
                $('td', nRow).each( function(i) {
                    this.innerHTML = aData[i].replace( regex, function(matched) { return "<span class='filterMatches'>"+matched+"</span>";});
                });
                return nRow;
            },
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.8/i18n/Chinese.json"
            },
            //"scrollX": "100%",

            "pageLength": 100,
            "order": [[ 0, "desc" ]],

            "columnDefs": [
                {
                    className: "dt-center",
                    "render": function ( data, type, row ) {
                        return data;
                    },"targets": "_all"//[0,1,2,3,4,5]
                },
                //{
                //"targets":  [5,6,7,8,9,10,11] ,
                //"visible": false
            //},
            ],

            "aoColumnDefs": [{ "bVisible": false, "aTargets": [5,6,7,8,9] }],

            
        } );//table

    } );
    </script>
{%endblock%}

{%block content%}
    
        <ul class="breadcrumb">
          <li><a href="/">主页</a></li>
          <li><a href="/dashboard/">控制台</a></li>
          <li class="active">搜索</li>
        </ul>
        <!-- Content Header (Page header) -->
        <section class="content-header">
          <h1>
            数据库
            <small>输入以搜索</small>
          </h1>
        </section>
        <!-- Main content -->
        <section class="content">
          <div class="row">
            <div class="col-xs-12">

              <div class="box">
                <div class="box-header">
                </div><!-- /.box-header -->
                <div class="box-body">
        
    <table class="table table-bordered table-striped" id="recent" class="display" cellspacing="0" width="90%" >
        <thead>
            <tr>
                <th>数据库编号</th>
                <th>姓名</th>
                <th>病历号</th>
                
                    <th>性别</th>
                    <th>出生年月</th>
                    <th>身份证号</th>
                    <th>地区</th>
                    <th>随访电话</th>
                    <th>去世日期</th>
                    <th>关系</th>
                    <th>电话</th>
                    <th>Email</th>
                    <th>微信</th>
                    <th>在随访中</th>

                <!--
                
                -->
            </tr>
        </thead>


        <tbody>
                {% for patient in patients %}
                        <tr>
                            <td><a href="{{patient.get_absolute_url}}">{{patient.DB_ID}}</a></td>
                            <td>{{patient.name}}</td>
                            <td>{{patient.EMR_id}}</td>

                                <td>{{patient.sex}}</td>
                                <td>{{patient.DOB}}</td>
                                <td>{{patient.social_id}}</td>
                                <td>{{patient.location}}</td>
                                <td>{{patient.phone}}</td>
                                <td>{{patient.DOD}}</td>
                                <td>{{patient.get_relative_display}}</td>
                                <td>{{patient.relative_phone}}</td>
                                <td>{{patient.relative_email}}</td>
                                <td>{{patient.relative_wechat}}</td>
                                <td>{{patient.get_relative_in_contact_display}}</td>

                        </tr>

                {% endfor %}
        </tbody>
    </table>

                </div><!-- /.box-body -->
              </div><!-- /.box -->
            </div><!-- /.col -->
          </div><!-- /.row -->
        </section><!-- /.content -->

{%endblock%}
